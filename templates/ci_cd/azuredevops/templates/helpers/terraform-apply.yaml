---
parameters:
  - name: terraform_action
    default: 'apply'
  - name: serviceConnection

steps:
  - task: AzureCLI@2
    displayName: Terraform Apply for $${{ coalesce(parameters.terraform_action, 'Apply') }}
    inputs:
      azureSubscription: $${{ parameters.serviceConnection }}
      scriptType: pscore
      scriptLocation: inlineScript
      inlineScript: |
        terraform apply -auto-approve tfplan
    env:
      ARM_USE_AZUREAD: true
      ARM_USE_CLI: true
